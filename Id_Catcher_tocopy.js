javascript:(async()=>{function t(t){return null==t?"":String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/%27/g,"&#39;")}function e(e){return t(e)}function i(t){return String(t||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"")}function r(t){let e=document.getElementById("hal-idcatcher-popup");e&&e.remove();let i=document.createElement("div");i.id="hal-idcatcher-popup",i.style.cssText="position:fixed;top:20px;right:20px;background:white;border:2px solid #444;padding:10px;z-index:99999;max-height:70%;overflow-y:auto;width:520px;font-family:sans-serif;",i.innerHTML=t;let r=document.createElement("button");r.textContent="Fermer",r.style.marginTop="10px",r.onclick=()=>i.remove(),i.appendChild(r),i.addEventListener("click",t=>{let e=t.target.closest("button[data-copy]");if(!e)return;let i=e.getAttribute("data-copy");navigator.clipboard?.writeText(i).then(()=>{let t=e.textContent;e.textContent="âœ“",setTimeout(()=>e.textContent=t,1e3)})}),document.body.appendChild(i)}try{let a=window.location.pathname.replace(/^\/|\/$/g,"").split("/").pop()||"";if(!a){r("<b>Impossible de d\xe9terminer l'ID auteur depuis l'URL.</b>");return}let l="",n="";try{let o=await fetch(%60https://api.archives-ouvertes.fr/search/?q=authIdPerson_i:${a}&fl=authLastName_s,authFirstName_s,authIdPerson_i&rows=50&wt=json%60);if(o.ok){let s=await o.json();for(let p of s.response?.docs||[]){let d=(Array.isArray(p.authIdPerson_i)?p.authIdPerson_i:[p.authIdPerson_i]).findIndex(t=>String(t)===String(a));if(-1!==d){l=(p.authFirstName_s||[])[d]||"",n=(p.authLastName_s||[])[d]||"";break}}}}catch(u){}if(!l&&!n){let f=document.querySelector("h3.mb-4")||Array.from(document.querySelectorAll("h3")).find(t=>/Modifications des informations de/i.test(t.innerText)||/Auteur\s*:/i.test(t.innerText)||/CrÃ©ation d'un auteur identifiÃ©/i.test(t.innerText));if(f){let c=f.innerText.trim(),m=c.match(/Auteur\s*:\s*(.+)/i)||c.match(/Modifications des informations de\s+(.+)/i);if(m){let g=m[1].trim().split(/\s+/).filter(Boolean);l=g.shift()||"",n=g.join(" ")||""}if(!l&&!n&&/CrÃ©ation d'un auteur identifiÃ©/i.test(c)){let b=document.querySelector("#sortable-form li[data-firstname][data-lastname]");b&&(l=b.getAttribute("data-firstname")||"",n=b.getAttribute("data-lastname")||"")}}}if(!l&&!n){r("<b>Impossible de d\xe9terminer le nom de l'auteur.</b>");return}let h=%60${l} ${n}%60.trim(),x,[y,v]=await Promise.allSettled([fetch(%60https://www.idref.fr/Sru/Solr?q=${encodeURIComponent(%60persname_t:(${n} AND ${l})%60)}&fl=id,ppn_z,affcourt_z,recordtype_z&rows=20&wt=json%60),fetch(%60https://pub.orcid.org/v3.0/search/?q=family-name:${encodeURIComponent(i(n))}+AND+given-names:${encodeURIComponent(i(l))}&rows=8%60,{headers:{Accept:"application/json"}})]),$=null;if("fulfilled"===y.status&&y.value.ok)try{let w=await y.value.text();w.trim().startsWith("{")&&($=JSON.parse(w))}catch(_){}let k=null;if("fulfilled"===v.status&&v.value.ok)try{k=await v.value.json()}catch(A){}let I=%60<div style="padding:6px;"><b>R\xe9sultats pour ${t(h)} :</b>%60;I+=%60<div style="margin-top:10px;"><h3 style="background:#E3F2FD;padding:6px;margin:0;">ðŸ“š IdRef</h3><ul style="padding-left:14px;margin-top:8px;">%60;let z=($?.response?.docs||[]).map(t=>({ppn:t.ppn_z||t.id||"",lib:t.affcourt_z||t.recordtype_z||""})).filter(t=>t.ppn);if(z.length){let C=await Promise.allSettled(z.map(t=>fetch(%60https://www.idref.fr/${t.ppn}.json%60).then(t=>t.ok?t.json():Promise.reject())));for(let j=0;j<z.length;j++){let{ppn:D,lib:E}=z[j],F="",S="",T=C[j];if("fulfilled"===T.status&&Array.isArray(T.value?.record?.datafield)){let q=T.value.record.datafield,N=t=>Array.isArray(t.subfield)?t.subfield:[t.subfield],R=(t,e)=>N(t).find(t=>String(t.code)===e)?.content,L=q.find(t=>"340"===String(t.tag));if(L){let P=String(R(L,"a")||"");P&&(F=%60<div style="margin-top:3px;font-size:12px;color:#555;font-style:italic;cursor:help;" title="${e(P)}">${t(P.length>100?P.substring(0,100)+"...":P)}</div>%60)}let M=q.filter(t=>"035"===String(t.tag)).find(t=>N(t).find(t=>"2"===String(t.code)&&"ORCID"===String(t.content).toUpperCase()));if(M){let O=String(R(M,"a")||"");O&&(S=%60<div style="margin-top:3px;"><b>ORCID :</b> <a href="https://orcid.org/${e(O)}" target="_blank" rel="noopener">${t(O)}</a> <button data-copy="${e(O)}" style="border:none;background:#81C784;color:white;padding:2px 6px;border-radius:3px;cursor:pointer;font-size:12px;margin-left:4px;">ðŸ“‹</button></div>%60)}let B=q.filter(t=>"510"===String(t.tag));if(B.length){let U=B.map(t=>({name:String(R(t,"a")||""),year:(String(R(t,"0")||"").match(/^(\d{4})/)||[])[1]||""})).filter(t=>t.name);if(U.length){for(let H of(F+='<div style="margin-top:5px;font-size:12px;color:#444;"><b>Affiliation(s) :</b><br/>',U))F+=%60<span style="margin-left:8px;">â€¢ ${t(H.name)}%60,H.year&&(F+=%60 <i>(depuis ${H.year})</i>%60),F+="</span><br/>";F+="</div>"}}}I+=%60<li style="margin-bottom:10px;padding-bottom:6px;border-bottom:1px solid #eee;">                           <a href="https://www.idref.fr/${e(D)}" target="_blank" rel="noopener"><b>${t(E)}</b></a>                           ${F}                           <div style="margin-top:4px;"><b>IDREF :</b> ${t(D)} <button data-copy="${e(D)}" style="border:none;background:#64B5F6;color:white;padding:2px 6px;border-radius:3px;cursor:pointer;font-size:12px;margin-left:4px;">ðŸ“‹</button>${S}</div>                         </li>%60}}else I+=%60<li>Aucun r\xe9sultat</li>%60;I+="</ul></div>",I+=%60<div style="margin-top:15px;"><h3 style="background:#E8F5E9;padding:6px;margin:0;">ðŸ”¬ ORCID</h3><ul style="padding-left:14px;margin-top:8px;">%60;let W=(k?.result||[]).map(t=>t["orcid-identifier"]?.path).filter(t=>t);if(W.length){let G=await Promise.allSettled(W.map(t=>fetch(%60https://pub.orcid.org/v3.0/${t}/person%60,{headers:{Accept:"application/json"}}).then(t=>t.ok?t.json():null)));for(let J=0;J<W.length;J++){let K=W[J],Q="fulfilled"===G[J].status?G[J].value:null,V=K;if(Q?.name){let X;V=%60${Q.name["given-names"]?.value||""} ${Q.name["family-name"]?.value||""}%60.trim()||K}I+=%60<li style="margin-bottom:10px;padding-bottom:6px;border-bottom:1px solid #eee;">                           <a href="https://orcid.org/${e(K)}" target="_blank" rel="noopener"><b>${t(V)}</b></a>                           <div style="margin-top:3px;color:#666;font-size:13px;">${t(K)} <button data-copy="${e(K)}" style="border:none;background:#81C784;color:white;padding:2px 6px;border-radius:3px;cursor:pointer;font-size:12px;margin-left:4px;">ðŸ“‹</button></div>                         </li>%60}}else I+=%60<li>Aucun r\xe9sultat</li>%60;I+="</ul></div></div>",r(I)}catch(Y){r("Erreur : "+t(Y?.message||String(Y)))}})();
