javascript:(async()=>{function t(t){return null==t?"":String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/%27/g,"&#39;")}function e(e){return t(e)}function i(t){return String(t||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"")}function r(t){let e=document.getElementById("hal-idcatcher-popup");e&&e.remove();let i=document.createElement("div");i.id="hal-idcatcher-popup",i.style.cssText="position:fixed;top:20px;right:20px;background:white;border:2px solid #444;padding:10px;z-index:99999;max-height:70%;overflow-y:auto;width:520px;font-family:sans-serif;",i.innerHTML=t;let r=document.createElement("button");r.textContent="Fermer",r.style.marginTop="10px",r.onclick=()=>i.remove(),i.appendChild(r),i.addEventListener("click",t=>{let e=t.target.closest("button[data-copy]");if(!e)return;let i=e.getAttribute("data-copy");navigator.clipboard?.writeText(i).then(()=>{let t=e.textContent;e.textContent="âœ“",setTimeout(()=>e.textContent=t,1e3)})}),document.body.appendChild(i)}try{let a=window.location.pathname.replace(/^\/|\/$/g,"").split("/").pop()||"";if(!a){r("<b>Impossible de d\xe9terminer l'ID auteur depuis l'URL.</b>");return}let n="",l="";try{let o=await fetch(%60https://api.archives-ouvertes.fr/search/?q=authIdPerson_i:${a}&fl=authLastName_s,authFirstName_s,authIdPerson_i&rows=50&wt=json%60);if(o.ok){let p=await o.json();for(let s of p.response?.docs||[]){let d=(Array.isArray(s.authIdPerson_i)?s.authIdPerson_i:[s.authIdPerson_i]).findIndex(t=>String(t)===String(a));if(-1!==d){n=(s.authFirstName_s||[])[d]||"",l=(s.authLastName_s||[])[d]||"";break}}}}catch(u){}if(!n&&!l){let f=document.querySelector("h3.mb-4")||Array.from(document.querySelectorAll("h3")).find(t=>/Modifications des informations de/i.test(t.innerText)||/Auteur\s*:/i.test(t.innerText)||/CrÃ©ation d'un auteur identifiÃ©/i.test(t.innerText));if(f){let c=f.innerText.trim(),m=c.match(/Auteur\s*:\s*(.+)/i)||c.match(/Modifications des informations de\s+(.+)/i);if(m){let g=m[1].trim().split(/\s+/).filter(Boolean);n=g.shift()||"",l=g.join(" ")||""}if(!n&&!l&&/CrÃ©ation d'un auteur identifiÃ©/i.test(c)){let b=document.querySelector("#sortable-form li[data-firstname][data-lastname]");b&&(n=b.getAttribute("data-firstname")||"",l=b.getAttribute("data-lastname")||"")}}}if(!n&&!l){r("<b>Impossible de d\xe9terminer le nom de l'auteur.</b>");return}let h=%60${n} ${l}%60.trim(),x,[y,v]=await Promise.allSettled([fetch(%60https://www.idref.fr/Sru/Solr?q=${encodeURIComponent(%60persname_t:(${l} AND ${n})%60)}&fl=id,ppn_z,affcourt_z,recordtype_z&rows=20&wt=json%60),fetch(%60https://pub.orcid.org/v3.0/search/?q=family-name:${encodeURIComponent(i(l))}+AND+given-names:${encodeURIComponent(i(n))}&rows=8%60,{headers:{Accept:"application/json"}})]),$=null;if("fulfilled"===y.status&&y.value.ok)try{let w=await y.value.text();w.trim().startsWith("{")&&($=JSON.parse(w))}catch(_){}let k=null;if("fulfilled"===v.status&&v.value.ok)try{k=await v.value.json()}catch(A){}let C=%60<div style="padding:6px;"><b>R\xe9sultats pour ${t(h)} :</b>%60;C+=%60<div style="margin-top:10px;"><h3 style="background:#E3F2FD;padding:6px;margin:0;">ðŸ“š IdRef</h3><ul style="padding-left:14px;margin-top:8px;">%60;let I=($?.response?.docs||[]).map(t=>({ppn:t.ppn_z||t.id||"",lib:t.affcourt_z||t.recordtype_z||""})).filter(t=>t.ppn);if(I.length){let z=await Promise.allSettled(I.map(t=>fetch(%60https://www.idref.fr/${t.ppn}.json%60).then(t=>t.ok?t.json():Promise.reject())));for(let j=0;j<I.length;j++){let{ppn:D,lib:E}=I[j],F="",S="",T="",q=z[j];if("fulfilled"===q.status&&Array.isArray(q.value?.record?.datafield)){let L=q.value.record.datafield,N=t=>Array.isArray(t.subfield)?t.subfield:[t.subfield],R=(t,e)=>N(t).find(t=>String(t.code)===e)?.content,P=L.find(t=>"340"===String(t.tag));if(P){let H=String(R(P,"a")||"");H&&(F=%60<div style="margin-top:3px;font-size:12px;color:#555;font-style:italic;cursor:help;" title="${e(H)}">${t(H.length>100?H.substring(0,100)+"...":H)}</div>%60)}let M=L.filter(t=>"035"===String(t.tag)).find(t=>N(t).find(t=>"2"===String(t.code)&&"ORCID"===String(t.content).toUpperCase()));if(M){let O=String(R(M,"a")||"");O&&(S=%60<div style="margin-top:3px;"><b>ORCID :</b> <a href="https://orcid.org/${e(O)}" target="_blank" rel="noopener">${t(O)}</a> <button data-copy="${e(O)}" style="border:none;background:#81C784;color:white;padding:2px 6px;border-radius:3px;cursor:pointer;font-size:12px;margin-left:4px;">ðŸ“‹</button></div>%60)}let U=L.filter(t=>"035"===String(t.tag)).find(t=>N(t).find(t=>"2"===String(t.code)&&"HAL"===String(t.content).toUpperCase()));if(U){let B=String(R(U,"a")||"");B&&(T=%60<div style="margin-top:3px;"><b>IDHAL :</b> ${t(B)} <button data-copy="${e(B)}" style="border:none;background:#1565C0;color:white;padding:2px 6px;border-radius:3px;cursor:pointer;font-size:12px;margin-left:4px;">ðŸ“‹</button></div>%60)}let W=L.filter(t=>"510"===String(t.tag));if(W.length){let G=W.map(t=>({name:String(R(t,"a")||""),year:(String(R(t,"0")||"").match(/^(\d{4})/)||[])[1]||""})).filter(t=>t.name);if(G.length){for(let J of(F+='<div style="margin-top:5px;font-size:12px;color:#444;"><b>Affiliation(s) :</b><br/>',G))F+=%60<span style="margin-left:8px;">â€¢ ${t(J.name)}%60,J.year&&(F+=%60 <i>(depuis ${J.year})</i>%60),F+="</span><br/>";F+="</div>"}}}C+=%60<li style="margin-bottom:10px;padding-bottom:6px;border-bottom:1px solid #eee;">                           <a href="https://www.idref.fr/${e(D)}" target="_blank" rel="noopener"><b>${t(E)}</b></a>                           ${F}                           <div style="margin-top:4px;"><b>IDREF :</b> ${t(D)} <button data-copy="${e(D)}" style="border:none;background:#64B5F6;color:white;padding:2px 6px;border-radius:3px;cursor:pointer;font-size:12px;margin-left:4px;">ðŸ“‹</button>${S}${T}</div>                         </li>%60}}else C+=%60<li>Aucun r\xe9sultat</li>%60;C+="</ul></div>",C+=%60<div style="margin-top:15px;"><h3 style="background:#E8F5E9;padding:6px;margin:0;">ðŸ”¬ ORCID</h3><ul style="padding-left:14px;margin-top:8px;">%60;let K=(k?.result||[]).map(t=>t["orcid-identifier"]?.path).filter(t=>t);if(K.length){let Q=await Promise.allSettled(K.map(t=>fetch(%60https://pub.orcid.org/v3.0/${t}/person%60,{headers:{Accept:"application/json"}}).then(t=>t.ok?t.json():null)));for(let V=0;V<K.length;V++){let X=K[V],Y="fulfilled"===Q[V].status?Q[V].value:null,Z=X;if(Y?.name){let tt;Z=%60${Y.name["given-names"]?.value||""} ${Y.name["family-name"]?.value||""}%60.trim()||X}C+=%60<li style="margin-bottom:10px;padding-bottom:6px;border-bottom:1px solid #eee;">                           <a href="https://orcid.org/${e(X)}" target="_blank" rel="noopener"><b>${t(Z)}</b></a>                           <div style="margin-top:3px;color:#666;font-size:13px;">${t(X)} <button data-copy="${e(X)}" style="border:none;background:#81C784;color:white;padding:2px 6px;border-radius:3px;cursor:pointer;font-size:12px;margin-left:4px;">ðŸ“‹</button></div>                         </li>%60}}else C+=%60<li>Aucun r\xe9sultat</li>%60;C+="</ul></div></div>",r(C)}catch(te){r("Erreur : "+t(te?.message||String(te)))}})();
